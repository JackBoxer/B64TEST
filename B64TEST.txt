import subprocess

def get_profiles():
    result = subprocess.run(['netsh', 'wlan', 'show', 'profiles'], capture_output=True, text=True)
    profiles = []
    for line in result.stdout.split('\n'):
        if "All User Profile" in line:
            profile_name = line.split(":")[1].strip()
            profiles.append(profile_name)
    return profiles

def get_password(profile_name):
    result = subprocess.run(['netsh', 'wlan', 'show', 'profile', f'name={profile_name}', 'key=clear'], capture_output=True, text=True)
    password = None
    for line in result.stdout.split('\n'):
        if "Key Content" in line:
            password = line.split(":")[1].strip()
            break
    return password

def main():
    profiles = get_profiles()
    for profile in profiles:
        password = get_password(profile)
        print(f'Profile: {profile}\nPassword: {password}\n')

if __name__ == "__main__":
    main()
